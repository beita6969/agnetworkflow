# A100æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—
# A100 Server Deployment Guide

## âœ… æœåŠ¡å™¨ä¿¡æ¯

### è¿æ¥ä¿¡æ¯
```
åœ°å€: ssh root@0.tcp.ngrok.io -p 11729
å¯†ç : MLUerV93OMJH
```

### ç¡¬ä»¶é…ç½®
```
GPU: NVIDIA A100-SXM4-40GB
æ˜¾å­˜: 40GB
é©±åŠ¨: 550.54.15
CUDA: 12.4
å­˜å‚¨: 197GB å¯ç”¨
```

### GPUçŠ¶æ€
```
âœ… nvidia-smi: æ­£å¸¸å·¥ä½œï¼ˆéœ€è¦è®¾ç½®LD_LIBRARY_PATHï¼‰
âœ… CUDA available: True
âœ… GPUæ¸©åº¦: 33Â°C
âœ… GPUåˆ©ç”¨ç‡: 0% (ç©ºé—²)
```

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ–‡ä»¶å·²ä¸Šä¼ 
æ‰€æœ‰è®­ç»ƒæ–‡ä»¶å·²ä¸Šä¼ åˆ° `/root/aflow_training/`ï¼š

```
deep_config_full_scale.yaml       (2.9KB)  - è®­ç»ƒé…ç½®
deep_train_real_workflow.py        (16KB)  - ä¸»è®­ç»ƒè„šæœ¬
deep_workflow_env.py                (15KB)  - RLç¯å¢ƒ
evaluate_full_dataset.py           (8.8KB)  - è¯„ä¼°è„šæœ¬
rl_trainer.py                       (20KB)  - RLè®­ç»ƒå™¨
start_full_scale_training.sh       (4.6KB)  - å¯åŠ¨è„šæœ¬
trainable_qwen_policy.py            (12KB)  - Qwenç­–ç•¥
unified_state.py                    (17KB)  - ç»Ÿä¸€çŠ¶æ€
workflow_evaluator.py               (12KB)  - Workflowè¯„ä¼°å™¨
workflow_parser.py                  (12KB)  - Workflowè§£æå™¨
workflow_prompt_manager.py         (7.5KB)  - Promptç®¡ç†
```

### 2. ç¯å¢ƒæ£€æŸ¥
```
âœ… Python 3
âœ… PyTorch 2.8.0+cu126
âœ… transformers (å·²å®‰è£…)
âœ… peft (å·²å®‰è£…)
âœ… datasets (å·²å®‰è£…)
âœ… CUDA available: True
```

---

## âš ï¸ è¿˜éœ€è¦å®Œæˆçš„æ­¥éª¤

### ç¬¬1æ­¥ï¼šä¿®å¤ç¯å¢ƒå˜é‡

GPUåº“è·¯å¾„éœ€è¦åœ¨æ¯æ¬¡ä½¿ç”¨æ—¶è®¾ç½®ã€‚åˆ›å»ºç¯å¢ƒé…ç½®ï¼š

```bash
ssh root@0.tcp.ngrok.io -p 11729
# å¯†ç : MLUerV93OMJH

# æ·»åŠ åˆ° .bashrc
echo 'export LD_LIBRARY_PATH=/usr/lib64-nvidia:$LD_LIBRARY_PATH' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯
nvidia-smi
```

### ç¬¬2æ­¥ï¼šä¸‹è½½Qwenæ¨¡å‹ï¼ˆ~15GBï¼Œéœ€è¦20-30åˆ†é’Ÿï¼‰

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p /root/models

# å®‰è£…huggingface-hubï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
pip install huggingface-hub

# ä¸‹è½½Qwen2.5-7B-Instructæ¨¡å‹
cd /root/models
python3 -c "
from huggingface_hub import snapshot_download
snapshot_download(
    repo_id='Qwen/Qwen2.5-7B-Instruct',
    local_dir='/root/models/Qwen2.5-7B-Instruct',
    local_dir_use_symlinks=False,
    resume_download=True
)
"

# éªŒè¯æ¨¡å‹å·²ä¸‹è½½
ls -lh /root/models/Qwen2.5-7B-Instruct/
# åº”è¯¥çœ‹åˆ° model-*.safetensors æ–‡ä»¶ï¼ˆçº¦15GBï¼‰
```

### ç¬¬3æ­¥ï¼šå®‰è£…/å…‹éš†AFlowæ¡†æ¶

è¿™ä¸ªæœåŠ¡å™¨ä¼¼ä¹æ²¡æœ‰AFlowã€‚æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š

#### é€‰é¡¹Aï¼šä»GitHubå…‹éš†
```bash
cd /root
git clone https://github.com/geekan/AFlow.git
cd AFlow
pip install -e .
```

#### é€‰é¡¹Bï¼šå¦‚æœå·²æœ‰AFlowä»£ç 
å¦‚æœæ‚¨åœ¨å…¶ä»–åœ°æ–¹ï¼ˆå¦‚åŸæ¥çš„æœåŠ¡å™¨ï¼‰å·²ç»æœ‰AFlowä»£ç ï¼Œå¯ä»¥æ‰“åŒ…åä¸Šä¼ ã€‚

### ç¬¬4æ­¥ï¼šé…ç½®APIå¯†é’¥

```bash
cd /root/aflow_training

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim deep_config_full_scale.yaml

# ä¿®æ”¹ä»¥ä¸‹è¡Œï¼ˆç¬¬32å’Œ39è¡Œï¼‰ï¼š
# å°† "YOUR_OPENAI_API_KEY_HERE"
# æ”¹ä¸ºæ‚¨çš„çœŸå®APIå¯†é’¥ "sk-..."
```

### ç¬¬5æ­¥ï¼šå®‰è£…å…¶ä»–ä¾èµ–åŒ…ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# å¯èƒ½éœ€è¦çš„åŒ…
pip install pyyaml
pip install openai
pip install anthropic  # å¦‚æœä½¿ç”¨Claude
pip install human-eval  # ç”¨äºHumanEvalè¯„ä¼°
```

---

## ğŸš€ å¯åŠ¨è®­ç»ƒ

å®Œæˆä¸Šè¿°æ‰€æœ‰æ­¥éª¤åï¼š

```bash
cd /root/aflow_training

# ç¡®ä¿ç¯å¢ƒå˜é‡å·²è®¾ç½®
export LD_LIBRARY_PATH=/usr/lib64-nvidia:$LD_LIBRARY_PATH

# å¯åŠ¨è®­ç»ƒ
chmod +x start_full_scale_training.sh
./start_full_scale_training.sh

# æˆ–è€…ç›´æ¥è¿è¡Œ
nohup python3 deep_train_real_workflow.py \
  --config deep_config_full_scale.yaml \
  > full_scale_training.log 2>&1 &

# ç›‘æ§è®­ç»ƒ
tail -f full_scale_training.log

# æŸ¥çœ‹å‡†ç¡®ç‡
grep "Pass@" full_scale_training.log | tail -20
```

---

## ğŸ“Š è®­ç»ƒé…ç½®è¯¦æƒ…

### å½“å‰é…ç½®
```yaml
device: "cuda"
total_epochs: 30
episodes_per_epoch: 5
sample: 131  # å®Œæ•´è®­ç»ƒé›†
experience_pool_size: 20000
model_path: "/root/models/Qwen2.5-7B-Instruct"
```

### é¢„è®¡è®­ç»ƒæ—¶é—´
```
æ¯episode: ~70åˆ†é’Ÿï¼ˆ131ä¸ªé—®é¢˜ï¼‰
æ¯epoch: ~5.8å°æ—¶ï¼ˆ5ä¸ªepisodesï¼‰
æ€»è€—æ—¶: ~174å°æ—¶ï¼ˆ~7.25å¤©ï¼Œ30ä¸ªepochsï¼‰
```

### A100æ€§èƒ½ä¼˜åŠ¿
åœ¨A100ä¸Šè®­ç»ƒä¼šæ¯”æ™®é€šGPUå¿«å¾ˆå¤šï¼š
- A100 vs RTX 3090: çº¦ **1.5-2x** é€Ÿåº¦æå‡
- é¢„è®¡æ€»è€—æ—¶å¯èƒ½ç¼©çŸ­åˆ° **4-5å¤©**

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šnvidia-smiæŠ¥é”™
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export LD_LIBRARY_PATH=/usr/lib64-nvidia:$LD_LIBRARY_PATH
nvidia-smi
```

### é—®é¢˜2ï¼šCUDAä¸å¯ç”¨
```bash
# éªŒè¯PyTorch CUDA
python3 -c "
import torch
print(f'CUDA available: {torch.cuda.is_available()}')
print(f'GPU name: {torch.cuda.get_device_name(0)}')
"

# å¦‚æœFalseï¼Œé‡è£…PyTorch
pip uninstall torch
pip install torch --index-url https://download.pytorch.org/whl/cu124
```

### é—®é¢˜3ï¼šæ‰¾ä¸åˆ°Qwenæ¨¡å‹
```bash
# æ£€æŸ¥æ¨¡å‹è·¯å¾„
ls -la /root/models/Qwen2.5-7B-Instruct/

# å¦‚æœæ²¡æœ‰ï¼Œé‡æ–°ä¸‹è½½ï¼ˆè§ç¬¬2æ­¥ï¼‰
```

### é—®é¢˜4ï¼šæ‰¾ä¸åˆ°AFlowæ¨¡å—
```bash
# æ£€æŸ¥AFlowå®‰è£…
python3 -c "import aflow; print('âœ… AFlowå·²å®‰è£…')"

# å¦‚æœæŠ¥é”™ï¼Œå®‰è£…AFlowï¼ˆè§ç¬¬3æ­¥ï¼‰
```

### é—®é¢˜5ï¼šOpenAI APIé”™è¯¯
```bash
# æ£€æŸ¥APIå¯†é’¥é…ç½®
grep "key:" deep_config_full_scale.yaml

# ç¡®ä¿æ˜¯çœŸå®å¯†é’¥ï¼Œä»¥ sk- å¼€å¤´
vim deep_config_full_scale.yaml
```

---

## ğŸ“ å¿«é€Ÿæ£€æŸ¥æ¸…å•

åœ¨å¯åŠ¨è®­ç»ƒå‰ï¼Œé€é¡¹ç¡®è®¤ï¼š

```
[ ] 1. ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼ˆLD_LIBRARY_PATHï¼‰
[ ] 2. nvidia-smi æ­£å¸¸å·¥ä½œ
[ ] 3. CUDA available: True
[ ] 4. Qwenæ¨¡å‹å·²ä¸‹è½½ï¼ˆ/root/models/Qwen2.5-7B-Instruct/ï¼‰
[ ] 5. AFlowå·²å®‰è£…
[ ] 6. OpenAI APIå¯†é’¥å·²é…ç½®
[ ] 7. ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆpyyaml, openaiç­‰ï¼‰
[ ] 8. æ‰€æœ‰è®­ç»ƒæ–‡ä»¶åœ¨ /root/aflow_training/
```

---

## ğŸ¯ ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼‰

åˆ›å»ºä¸€ä¸ªä¸€é”®éƒ¨ç½²è„šæœ¬æ¥è‡ªåŠ¨å®Œæˆä¸Šè¿°æ­¥éª¤ï¼š

```bash
#!/bin/bash
# /root/aflow_training/setup_and_train.sh

set -e  # Exit on error

echo "=== å¼€å§‹A100æœåŠ¡å™¨éƒ¨ç½² ==="
echo ""

# 1. ç¯å¢ƒå˜é‡
echo "[1/6] é…ç½®ç¯å¢ƒå˜é‡..."
export LD_LIBRARY_PATH=/usr/lib64-nvidia:$LD_LIBRARY_PATH
echo 'export LD_LIBRARY_PATH=/usr/lib64-nvidia:$LD_LIBRARY_PATH' >> ~/.bashrc
nvidia-smi
echo ""

# 2. ä¸‹è½½Qwenæ¨¡å‹
if [ ! -d "/root/models/Qwen2.5-7B-Instruct" ]; then
    echo "[2/6] ä¸‹è½½Qwenæ¨¡å‹ï¼ˆ~15GBï¼Œéœ€è¦20-30åˆ†é’Ÿï¼‰..."
    mkdir -p /root/models
    cd /root/models
    python3 -c "
from huggingface_hub import snapshot_download
snapshot_download(
    repo_id='Qwen/Qwen2.5-7B-Instruct',
    local_dir='/root/models/Qwen2.5-7B-Instruct',
    local_dir_use_symlinks=False,
    resume_download=True
)
"
    echo "âœ… Qwenæ¨¡å‹ä¸‹è½½å®Œæˆ"
else
    echo "[2/6] Qwenæ¨¡å‹å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½"
fi
echo ""

# 3. å®‰è£…AFlow
if ! python3 -c "import aflow" 2>/dev/null; then
    echo "[3/6] å®‰è£…AFlow..."
    cd /root
    if [ ! -d "AFlow" ]; then
        git clone https://github.com/geekan/AFlow.git
    fi
    cd AFlow
    pip install -e .
    echo "âœ… AFlowå®‰è£…å®Œæˆ"
else
    echo "[3/6] AFlowå·²å®‰è£…ï¼Œè·³è¿‡"
fi
echo ""

# 4. å®‰è£…ä¾èµ–
echo "[4/6] å®‰è£…ä¾èµ–åŒ…..."
pip install -q pyyaml openai human-eval anthropic
echo "âœ… ä¾èµ–åŒ…å®‰è£…å®Œæˆ"
echo ""

# 5. éªŒè¯ç¯å¢ƒ
echo "[5/6] éªŒè¯ç¯å¢ƒ..."
python3 << 'EOF'
import torch
print(f"âœ… CUDA available: {torch.cuda.is_available()}")
print(f"âœ… GPU: {torch.cuda.get_device_name(0)}")

import os
model_path = "/root/models/Qwen2.5-7B-Instruct"
if os.path.exists(model_path):
    print(f"âœ… Qwen model exists")
else:
    print(f"âŒ Qwen model NOT found at {model_path}")
    exit(1)

try:
    import aflow
    print("âœ… AFlow imported")
except:
    print("âŒ AFlow NOT found")
    exit(1)
EOF
echo ""

# 6. æç¤ºé…ç½®APIå¯†é’¥
echo "[6/6] è¯·é…ç½®OpenAI APIå¯†é’¥..."
echo "è¿è¡Œ: vim /root/aflow_training/deep_config_full_scale.yaml"
echo "ä¿®æ”¹ key: 'YOUR_OPENAI_API_KEY_HERE' ä¸ºæ‚¨çš„çœŸå®APIå¯†é’¥"
echo ""

echo "=== éƒ¨ç½²å®Œæˆï¼==="
echo ""
echo "ä¸‹ä¸€æ­¥:"
echo "1. é…ç½®APIå¯†é’¥: vim /root/aflow_training/deep_config_full_scale.yaml"
echo "2. å¯åŠ¨è®­ç»ƒ: cd /root/aflow_training && ./start_full_scale_training.sh"
echo ""
```

ä¿å­˜å¹¶è¿è¡Œï¼š
```bash
chmod +x /root/aflow_training/setup_and_train.sh
/root/aflow_training/setup_and_train.sh
```

---

## ğŸ“ æœåŠ¡å™¨ä¿¡æ¯æ‘˜è¦

```
è¿æ¥: ssh root@0.tcp.ngrok.io -p 11729
å¯†ç : MLUerV93OMJH
GPU: NVIDIA A100-SXM4-40GB (40GB)
å·¥ä½œç›®å½•: /root/aflow_training/
é…ç½®æ–‡ä»¶: deep_config_full_scale.yaml
```

---

## âœ… å½“å‰çŠ¶æ€

### å·²å®Œæˆ
- âœ… æ‰¾åˆ°A100 GPUæœåŠ¡å™¨
- âœ… éªŒè¯GPUå¯ç”¨ï¼ˆCUDA: Trueï¼‰
- âœ… ä¸Šä¼ æ‰€æœ‰è®­ç»ƒæ–‡ä»¶
- âœ… åŸºç¡€PythonåŒ…å·²å®‰è£…

### å¾…å®Œæˆ
- â³ é…ç½®ç¯å¢ƒå˜é‡ï¼ˆLD_LIBRARY_PATHï¼‰
- â³ ä¸‹è½½Qwenæ¨¡å‹ï¼ˆ~15GBï¼‰
- â³ å®‰è£…AFlowæ¡†æ¶
- â³ é…ç½®OpenAI APIå¯†é’¥
- â³ å¯åŠ¨è®­ç»ƒ

---

**ğŸ“ æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-10-15 14:10
**ğŸ“ å·¥ä½œç›®å½•**: `/root/aflow_training/`
**ğŸ¯ ç›®æ ‡**: åœ¨A100ä¸Šè¿›è¡Œå®Œæ•´HumanEvalæ•°æ®é›†è®­ç»ƒï¼ˆ131ä¸ªé—®é¢˜ï¼‰
**â±ï¸ é¢„è®¡è€—æ—¶**: 4-5å¤©ï¼ˆA100åŠ é€Ÿåï¼‰
